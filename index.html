<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>投票</title>
</head>
<body>
  <!-- 您的网页内容 -->
  <h1>投票</h1>
  <p>您最喜歡的programming language是？</p>
  <button onclick="vote('JavaScript')">JavaScript</button>
  <button onclick="vote('Python')">Python</button>
  <button onclick="vote('Java')">Java</button>
  <!-- 显示结果的区域 -->
  <div id="results"></div>

  <!-- Firebase SDK和您的脚本 -->
  <script type="module">
    // 导入Firebase核心和数据库函数
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    // 您的Firebase配置
    const firebaseConfig = {
  apiKey: "AIzaSyCRol5-bfvuLJ_Tl3HzhE1_JfzIU837wsk",
  authDomain: "livepollingapp.firebaseapp.com",
  databaseURL: "https://livepollingapp-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "livepollingapp",
  storageBucket: "livepollingapp.appspot.com",
  messagingSenderId: "512425859331",
  appId: "1:512425859331:web:4e8e84385defd5637cf136",
  measurementId: "G-EDJ488Y4JK"
    };

    // 初始化Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // 投票函数
    window.vote = function(option) {
      const pollRef = ref(database, 'polls/favoriteLanguage/' + option);

      runTransaction(pollRef, (currentVotes) => {
        return (currentVotes || 0) + 1;
      }).then(() => {
        console.log('投票成功！');
      }).catch((error) => {
        console.error('投票失败：', error);
      });
    }

    // real time result
    const resultsDiv = document.getElementById('results');
    const resultsRef = ref(database, 'polls/favoriteLanguage');

    onValue(resultsRef, (snapshot) => {
      const data = snapshot.val();
      resultsDiv.innerHTML = '';
      if (data) {
        for (let option in data) {
          resultsDiv.innerHTML += `<p>${option}: ${data[option]} 票</p>`;
        }
      } else {
        resultsDiv.innerHTML = '<p>no投票结果。</p>';
      }
    });
  </script>
</body>
</html>