<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>投票</title>
</head>
<body>
   <!-- 您的网页内容 -->
   <h1>投票</h1>
   <!-- 问题1 -->
   <p>第一次嚟華基堂？</p>
   <button onclick="vote('q1', '是')">是</button>
   <button onclick="vote('q1', '否')">否</button>
   <!-- 问题2 -->
   <p>係咪基督徒？</p>
   <button onclick="vote('q2', '是')">是</button>
   <button onclick="vote('q2', '否')">否</button>
   <!-- 问题3 -->
   <p>有冇喺社交媒體 (IG、Facebook) Post過相？</p>
   <button onclick="vote('q3', '是')">是</button>
   <button onclick="vote('q3', '否')">否</button>
   <!-- 问题4 -->
   <p>通常 Post 乜嘢？</p>
   <button onclick="vote('q4', '自拍')">自拍</button>
   <button onclick="vote('q4', '美食')">美食</button>
   <button onclick="vote('q4', '風景')">風景</button>
   <button onclick="vote('q4', '仔女')">仔女</button>
   <!-- 问题5 -->
   <p>Post有自己樣嘅相，有冇用Filter？</p>
   <button onclick="vote('q5', '是')">是</button>
   <button onclick="vote('q5', '否')">否</button>
   <!-- 显示“投票成功”的区域 -->
   <div id="vote-success-message" style="color: green; font-weight: bold;"></div>
   <!-- 页面底部的“查看结果”按钮 -->
   <div style="margin-top: 20px;">
     <button onclick="goToResultsPage()">查看结果</button>
   </div>
   
  <!-- Firebase SDK和您的脚本 -->
  <script type="module">
    // 导入Firebase核心和数据库函数
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getDatabase, ref, onValue, runTransaction } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";

    // 您的Firebase配置
    const firebaseConfig = {
  apiKey: "AIzaSyCRol5-bfvuLJ_Tl3HzhE1_JfzIU837wsk",
  authDomain: "livepollingapp.firebaseapp.com",
  databaseURL: "https://livepollingapp-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "livepollingapp",
  storageBucket: "livepollingapp.appspot.com",
  messagingSenderId: "512425859331",
  appId: "1:512425859331:web:4e8e84385defd5637cf136",
  measurementId: "G-EDJ488Y4JK"
    };

  // 初始化Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  // 投票函数
  window.vote = function(questionId, option) {
    const pollRef = ref(database, 'polls/' + questionId + '/' + option);

    runTransaction(pollRef, (currentVotes) => {
      return (currentVotes || 0) + 1;
    }).then(() => {
      console.log('投票成功！');
    }).catch((error) => {
      console.error('投票失败：', error);
    });
  }

  // 创建结果监听函数
  function setupResultListener(questionId) {
    const resultsDiv = document.getElementById('results-' + questionId);
    const resultsRef = ref(database, 'polls/' + questionId);

    onValue(resultsRef, (snapshot) => {
      const data = snapshot.val();
      resultsDiv.innerHTML = '';
      if (data) {
        for (let option in data) {
          resultsDiv.innerHTML += `<p>${option}: ${data[option]} 票</p>`;
        }
      } else {
        resultsDiv.innerHTML = '<p>暂无投票结果。</p>';
      }
    });
  }

  // 为每个问题设置结果监听器
  setupResultListener('q1');
  setupResultListener('q2');
  setupResultListener('q3');
  setupResultListener('q4');
  setupResultListener('q5');
</script>
</body>
</html>